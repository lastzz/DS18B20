C51 COMPILER V9.00   TEXT3                                                                 06/18/2014 10:57:10 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE TEXT3
OBJECT MODULE PLACED IN Text3.OBJ
COMPILER INVOKED BY: D:\Keil\C51\BIN\C51.EXE Text3.c LARGE BROWSE INCDIR(..\delay;..\GUI;..\USER;..\ds18b20;..\tft) DEBU
                    -G OBJECTEXTEND

line level    source

   1          
   2          
   3          #include  "stc12.h"
   4          #include  "gui.h"
   5          #include  "delay.h"
   6          #include  "tft.h"
   7          #include  "def.h"                         //宏定义 常用函数
   8          #include  "ds18b20.h"
   9          //#include  "crastal.h"
  10          
  11          
  12          
  13          //此数组 用于显示数字0-9    数字来着于 字符 zifu8x16.h
  14          uint asc[10]={48,49,50,51,52,53,54,55,56,57}; 
  15          
  16           unsigned int t=0;
  17          
  18          main()
  19          {               
  20   1               unsigned int x,y ;
  21   1              
  22   1              Lcd_Init();   //tft初始化
  23   1              LCD_CS =0;  //打开片选使能      
  24   1       //GUI_Clear(0xffff);   //清屏  
  25   1      
  26   1      /*==============人机界面绘制=================*/
  27   1              GUI_Clear(0);//清屏
  28   1      
  29   1              GUI_box(0,0,239,15,0x001f);
  30   1      
  31   1      //      GUI_sprintf_HZ(16, 0, 0x07ff,0x001f);//显示预定义汉字字符串     
  32   1          GUI_sprintf_hzstr16s(16,0,"新疆工程学院温度采集程序",Black,Cyan);
  33   1      
  34   1      
  35   1      /*===========================================*/
  36   1      TMOD=0x01;/*设置定时器0为工作方式1*/
  37   1      
  38   1              TH0=0x4c;/*T0重新置初值(25mS)*/
  39   1              TL0=0;
  40   1      
  41   1              ET0=1;/*开定时器0中断*/
  42   1              EA=1;/*开总中断*/
  43   1              TR0=1;/*启动定时器0*/
  44   1              
  45   1      ReadROM();
  46   1      display00();
  47   1      while(1);
  48   1      }
*** WARNING C280 IN LINE 20 OF TEXT3.C: 'x': unreferenced local variable
*** WARNING C280 IN LINE 20 OF TEXT3.C: 'y': unreferenced local variable
  49          
  50          
  51          /*---中断服务程序---*/
  52          void Timer0_Routine(void) interrupt 1
C51 COMPILER V9.00   TEXT3                                                                 06/18/2014 10:57:10 PAGE 2   

  53          {
  54   1          int tp;/*寄存器定义*/
  55   1              unsigned int y;
  56   1              unsigned char a;
  57   1      //      unsigned int tp,y;/*寄存器定义*/
  58   1      //      unsigned char x;
  59   1      
  60   1      //      unsigned char a;
  61   1              TH0=0x4c;/*T0重新置初值(25mS)*/
  62   1              TL0=0;
  63   1              a++;
  64   1              if (a==40)/*已经发生40次中断了吗？*/
  65   1              {
  66   2                      a=0;/*是，1S时间到*/
  67   2                      
  68   2                      GUI_sprintf_chartodec(189,302,t,0xf800,0);/* 无符号字符型数以十进制形式显示*/
  69   2                      tp=read_temp();/*调用温度转换函数*/
  70   2                      if(tp>0x3fff) /*判断是否为负温，若是负温，前面显示负号*/
  71   2                      {      
  72   3                              GUI_sprintf_char(60,302, '-', 0xf800,0);/*是负温，前面显示负号*/
  73   3                              GUI_wrlval(107,302, tp&0x3fff,4,2,0xf800,0);/*写入要显示的长变量*/
  74   3                              tp=1000-tp&0x3fff;/*得到从负10度为起点的相对温度值*/
  75   3                      }
  76   2                      else
  77   2                      {      
  78   3                              GUI_sprintf_char(60,302, '+', 0xf800,0);/*是正温，前面显示正号*/
  79   3                              GUI_wrlval(107,302, tp&0x3fff,4,2,0xf800,0);/*写入要显示的长变量*/
  80   3                              tp=1000+tp&0x3fff;/*得到从负10度为起点的相对温度值*/
  81   3                      }
  82   2                      y=275-tp/20;/*计算打点位置*/
  83   2      
  84   2      
  85   2      
  86   2      //              x=28+t;
  87   2      //              GUI_Point(x, y, 0xffff);
  88   2      
  89   2      
  90   2      
  91   2      
  92   2                      /*第一次测量是不准确的，不予显示*/
  93   2                      if (tp<5000)
  94   2                      {
  95   3                              GUI_Point(t+28, y, 0xffff);//画点
  96   3                              t=t+1;
  97   3                              while(t==201);/*测量结束*/
  98   3                      }
  99   2                       
 100   2              }
 101   1      }
 102          
 103          
 104          
 105          
 106          
 107          
 108          
 109          
 110          
 111          
 112          
 113          /*
 114          GUI_sprintf_hzstr16s(20,50,"温度采集程序",Black,Cyan);
C51 COMPILER V9.00   TEXT3                                                                 06/18/2014 10:57:10 PAGE 3   

 115          GUI_sprintf_hzstr16s(20,66,"当前温度值",Black,White);
 116          GUI_sprintf_hzstr16s(101,66,":  . c",Black,White);
 117           while(1)
 118           {
 119           delayms(800);
 120            temperature=read_temp();                                //读取当前温度值 到temperature
 121          
 122                   GUI_sprintf_char(109,66,asc[temperature%1000/100],Red,White);     //显示当前温度值
 123                   GUI_sprintf_char(117,66,asc[temperature%100/10],Red,White);
 124                   GUI_sprintf_char(133,66,asc[temperature%10],Red,White);
 125           
 126           }
 127                  
 128                  
 129          }         
 130          */
 131          
 132          
 133          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    487    ----
   CONSTANT SIZE    =     25    ----
   XDATA SIZE       =     22       7
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  2 WARNING(S),  0 ERROR(S)
